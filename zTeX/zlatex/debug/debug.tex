\documentclass{article}


\begin{document}
\ExplSyntaxOn
\cs_new:Npn \__aaa_bbb:n #1 
  {HELLO~#1}

% \__aaa_bbb:n {WORLD}
\__aaa_bbb_:n {WORLD}
\ExplSyntaxOff
\end{document}




% test ztex after explcheck
\InputIfFileExists{zlatex-cfg.tex}{}{}
\documentclass[layout={slide}]{../code/ztex}
\zthmnew{Zaxiom, Ztheorem=Thm|{HTML}{a0d911}, Zproposition=Prop|blue}
\zthmnew[proof]{Zproof, Zexample=EXAMPLE|red, Zsolution=Solution|}
\zthmstyle{background}

\begin{document}
\begin{Zproof}[zthmnew-1]
  This is a Zproof zthmnew-1.
  \end{Zproof}
  \begin{Zexample}[zthmnew-2]
  This is a Zexample zthmnew-2.
  \end{Zexample}
  \begin{Ztheorem}[zthmnew-3]
  This is a Ztheorem zthmnew-3
  \end{Ztheorem}
\end{document}



% test thm module
\InputIfFileExists{zlatex-cfg.tex}{}{}
\documentclass[
  fancy,
  class=book,
  lang=cn, 
]{../code/ztex}
\makeatletter
\zthmstylenew{
  styleA={
    begin={
      \begin{tcolorbox}[
        enhanced jigsaw,
        breakable, sharp corners, 
        colframe=\thm@tmp@color, 
        top=2ex, boxrule=2pt, toprule=0pt, 
        fonttitle=\large\bfseries, colback=white, 
        attach boxed title to top left={xshift=3em,yshift=-\tcboxedtitleheight/2},
        coltitle=\thm@tmp@color, title={\zthmname~\zthmnumber},
        boxed title style={%
          empty, left=1pt, right=1pt, bottom=0pt,
          overlay={%
            \draw[color=\thm@tmp@color,line width=2pt,line cap=round]
            ([yshift=-1pt]frame.west)--
            ++(-2.9em,0) ([yshift=-1pt]frame.east)--
            ++(3em,0);
          }
        },
      ]
    },
    end = {\end{tcolorbox}},
  }
}
\makeatother
\zthmstyle{styleA}
\zthmlang{en}
\usepackage{zhlipsum}
\usepackage{lipsum}


\begin{document}
\mainmatter
\chapter{FIRST CHAP}
\section{FIRST}
\lipsum[1][1-2]
\begin{definition}[DEF-TEST]\label{def:A}
  \lipsum[1][1-2]
  \begin{align}
    \sum_{i=1}^{+\infty}{\int_{0}^{i}-\frac{1}{t}\mathrm{d}t} = \frac{\pi^2}{6}
  \end{align}
  \lipsum[1][3-5]
\end{definition}
\lipsum[1][3-5] -- \cref{thm:A}.


\vspace*{13em}
\section{SECOND}
\begin{theorem}[THM-TEST]\label{thm:A}
  \zhlipsum[1]
\end{theorem}
\lipsum[1][3-5] -- \cref{def:A}.
\end{document}






% ==> ztex font module test
\InputIfFileExists{zlatex-cfg.tex}{}{}
\documentclass[lang=cn]{../code/ztex}
% \documentclass{ctexart}
% \usepackage{lipsum}
% \usepackage{zhlipsum}
% \setmainfont{Times New Roman}
% \ztexset{mathSpec={font=mathpazo}}
% \zfontset{
%   sysfont,
%   % doc = lmm,
%   % text=times,
%   math = euler
% }
\zfontfamilynew[CJK]{
  cmd = YaHei, 
  name = msyh.ttc,
  path = ./Fonts/, 
  % feat = { bd=*bd } 
}
\zfontfamilynew{
  cmd = Arial,
  name = arial.ttf,
  path = ./Fonts/,
  feat = {sl=*i}
}
% % do NOT 'file name' and  'font name' in one decalre.
% \zfontfamilynew{
%   cmd = SourceCodePro,
%   name = Source Code Pro,
%   feat = { bd=Source Code Pro Bold }
% }
% \newfontfamily\TEST{Times New Roman}
%   [
%     BoldFont = Times New Roman,
%     ItalicFont = Times New Roman
%   ]
% \xeCJKsetup{EmboldenFactor=8}
% \setCJKfamilyfont{NewYH}{msyh.ttc}
%   [
%     Path = ./Fonts/,
%     AutoFakeBold = 12, % works
%     % AutoFakeBold = true,
%     % EmboldenFactor = 1, % do NOT make sense, when just use this.
%     % BoldFont = msyhbd.ttc
%   ]

% \setCJKfamilyfont{NewYHII}{msyh.ttc}
%   [
%     Path = ./Fonts/,
%     % AutoFakeBold = 8, % works.
%     % 
%     AutoFakeBold = true,
%     % EmboldenFactor = 8, 
%     % NOTE:
%     % 1. do NOT make sense, when just use this.
%     % 2. can NOT use this arg in local.
%   ]


\begin{document}
\ExplSyntaxOn
% \def\bdnum{\fp_use:N \g__xeCJK_embolden_factor_fp}
% \fp_gset:Nn \g__xeCJK_embolden_factor_fp {10}
\ExplSyntaxOff

% System: {你好世界,\bfseries 你好世界}.

% {\CJKfamily{NewYH}\bdnum{} 你好世界,\bfseries 你好世界.}

% {\CJKfamily{NewYHII}\bdnum{} 你好世界,\bfseries 你好世界.}

{\YaHei 你好世界,\bfseries 你好世界.}


{\Arial Hello world,\slshape Hello world.}


% {Hello world,\SourceCodePro Hello world,\bfseries Hello world.}
\end{document}





% ==> box scale
\InputIfFileExists{zlatex-cfg.tex}{}{}
\documentclass[lang=en, hyper]{../code/ztex}
\usepackage{minted}
% \usepackage[T4,T1]{fontenc}
% \newcommand{\USP}[1]{{\fontencoding{T4}\selectfont\char"20}}
\ExplSyntaxOn\makeatletter
\setlength\fboxsep{0pt}
% \NewDocumentCommand{\ztexscatter}{O{\use:n}mm}
%   {% #1:item cmd, #2:width; #3:object
%     \hb@xt@#2{
%       \tl_map_inline:nn {#3} 
%         {
%           \seq_put_right:No \l__ztex_scatter_seq {#1{##1}}
%         } 
%       \seq_use:Nn \l__ztex_scatter_seq { \hfill }
%     }
%     \seq_clear:N \l__ztex_scatter_seq
%   }
% \seq_new:N \l__ztex_scatter_seq
% \cs_generate_variant:Nn \tl_set:Nn {No}
% \gdef\ztoolWdScale#1{\textcolor{blue}{\ztool_onlyset_to_wd:nn {1em}{#1}}}
\gdef\ztoolWdScale#1{\textcolor{blue}{#1}}
\ExplSyntaxOff

\ExplSyntaxOn
\clist_new:N \l__ztex_doc_source_clist
\clist_clear:N \l__ztex_doc_source_clist
\cs_set:Npn \__ztex_doc_source:nn #1#2 
  {
    \clist_map_inline:nn {#2}
      {
        \clist_put_right:Nn \l__ztex_doc_source_clist 
          {
            \subsubsection{##1}
            \inputminted{latex}{../code/#1/ztex.#1.##1.tex}
          }
      }
  }
\newcommand{\inputZTeXSource}[2][module]
  {
    \__ztex_doc_source:nn {#1}{#2}
    \clist_use:Nn \l__ztex_doc_source_clist   
      { \newpage }
  }
\ExplSyntaxOff


\begin{document}
\section{\ztex{} and \ztex*}
\zTeX*{} introduction. Introduction to \zTeX{} and \ztex*.

Hello, this is \zlatex{} and \zlatex*{}. 


Space token:{\usefont{OT1}{cmtt}{m}{n}\asciispace}
% Space token: \USP{ }.
% \ztexscatter{5em}{mmm}


\underline{%
  \zboxitemalign[cmd=\ztoolWdScale, type=scatter]{9em}{{Tom}{Amy}{Jennery}}%
}

\underline{%
  \zboxitemalign[cmd=\ztoolWdScale, type=right]{9em}{{Tom}{Amy}{Jennery}}%
}


\underline{%
  \zboxitemalign[cmd=\ztoolWdScale, type=center]{9em}{Tom Amy\ Jenn ery}%
}

\underline{%
  \zboxitemalign[cmd=\ztoolWdScale, type=left]{9em}{{Tom}{Amy}{Jennery}}%
}


% \inputZTeXSource{box, font}
% \inputZTeXSource[library]{fancy, alias}

\ExplSyntaxOn
% \def\zTeX{
%   \texorpdfstring{
%     \ztool_set_to_wd:nn {7pt}{
%       \ztool_rotate:nn {89.25}{\(\aleph\)}
%     }\kern-1.5pt\hbox{}\TeX{}
%   }{zTeX}
% }


% \maketitle
% \ExplSyntaxOn
% \ztool_onlyset_to_wd:nn {2em}{A}\par
% \ztool_onlyset_to_wd:nn {2em}{AA}\par
% \ztool_onlyset_to_wd:nn {2em}{AAA}\par
% \ztool_onlyset_to_wd:nn {2em}{AAAA}\par
% \ztool_onlyset_to_wd:nn {2em}{AAAAAA}\par

% \ztool_onlyset_to_ht:nn {2.5em}{\fbox{\vbox{\hbox{A}}}}\quad
% \ztool_onlyset_to_ht:nn {2.5em}{\fbox{\vbox{\hbox{A}\hbox{A}}}}\quad
% \ztool_onlyset_to_ht:nn {2.5em}{\fbox{\vbox{\hbox{A}\hbox{A}\hbox{A}}}}\quad
% \ztool_onlyset_to_ht:nn {2.5em}{\fbox{\vbox{\hbox{A}\hbox{A}\hbox{A}\hbox{A}}}}


% box height test
% \hbox_set:Nn \l_tmpa_box {\huge\bfseries Hello}
% \dim_set:Nn \l_tmpa_dim { \box_ht:N \l_tmpa_box }
% \dim_show:N \l_tmpa_dim
% luatex:15.32524pt; xetex:15.32524pt % ==> no bug


% \hbox_set:Nn \l_tmpb_box {
%   \parbox[b][][r]{10em}{
%       {\huge\bfseries Hello}\\[0pt]
%       {\huge\bfseries world}
%     }
% }
% \dim_set:Nn \l_tmpb_dim { \box_ht:N \l_tmpb_box }
% \dim_show:N \l_tmpb_dim
% luatex:31.7667pt; xetex:31.7667pt % ==> no bug


% \long\def\formatTitle{{\huge\bfseries \zTeX{} 用户手册}}
% \long\def\formatAuthor{{\Large\bfseries World}}
% \newcommand\titleUpperBox[2][0pt]{
%   \parbox[b][#2][r]{\l_tmpa_dim}{
%     {\formatTitle}\\[#1]
%     {\formatAuthor}
%   }
% }
% \ztool_get_ht_plus_dp:Nn \l_tmpb_dim {\titleUpperBox{}}
% \dim_show:N \l_tmpb_dim % luatex:80.14294pt; xetex:\l_tmpb_dim=75.46144pt % bug


% \hbox_set:Nn \l_tmpa_box {\huge\bfseries 用户手册}
% \dim_set:Nn \l_tmpa_dim { \box_ht:N \l_tmpa_box }
% \dim_show:N \l_tmpa_dim
% luatex:19.43259pt; xetex:16.73853pt % bug !!!!
\ExplSyntaxOff
\end{document}


% \documentclass{article}
% \usepackage[T1]{fontenc}

% \begin{document}
% \ExplSyntaxOn
% \cs_set_eq:NN \cctabend \cctab_end:
% \cctab_const:Nn \g__ztex_keyval_cctab 
% {
%   \cctab_select:N \c_document_cctab
%   \char_set_catcode_active:n {124}
% }
% \cctab_begin:N \g__ztex_keyval_cctab
% \gdef|{XXX}

% ||\par
% \cctabend
% ||
% \ExplSyntaxOff
% \end{document}


% ==> format l3doc syntax description
\InputIfFileExists{zlatex-cfg.tex}{}{}
\documentclass[class=l3dox]{../code/ztex}
% \documentclass[twoside]{l3dox}
% \usepackage{xcolor}
% \usepackage{geometry}
\AtBeginDocument{
  % \DeleteShortVerb \"
  \DeleteShortVerb \|
}
\catcode`>=13\gdef>{\dotfill}
% \catcode`|=13
% \AddToHook{env/function/begin}{\def|{\textup{\string|}}}
% \AddToHook{env/function/after}{\catcode`|=12}
% key-value env 
\ExplSyntaxOn
\cs_new_protected:Npn \__codedoc_function_ztex:nnw #1#2
  {
    \__codedoc_function_typeset_start:
    \__codedoc_function_init:
    \tl_set:Nn \l__codedoc_macro_argument_tl {#2}
    \keys_set:nn { l3doc/function } {#1}
    \__codedoc_names_get_seq_ztex:nN {#2} \l__codedoc_names_seq
    \__codedoc_names_parse:
    \__codedoc_function_typeset:
    \__codedoc_function_reset:
    \__codedoc_function_descr_start:w
  }
\cs_new_protected:Npn \__codedoc_names_get_seq_ztex:nN #1#2
  {
    \bool_if:NTF \l__codedoc_names_verb_bool
      {
        \seq_clear:N #2
        \seq_put_right:No #2 { {#1} }
      }
      {
        \tl_set:Nn \l__codedoc_tmpa_tl {#1}
        \tl_remove_all:Ne \l__codedoc_tmpa_tl
          { \exp_not:N \obeyedline \c_percent_str }
        \tl_remove_all:Ne \l__codedoc_tmpa_tl
          { \exp_not:N \obeyedline }
        \__kernel_tl_set:Nx \l__codedoc_tmpa_tl { \l__codedoc_tmpa_tl }
        \tl_remove_all:Ne \l__codedoc_tmpa_tl
          { \iow_char:N \^^M \c_percent_str }
        \tl_remove_all:Ne \l__codedoc_tmpa_tl { \tl_to_str:n { ^ ^ A } }
        \tl_remove_all:Ne \l__codedoc_tmpa_tl { \iow_char:N \^^I }
        \tl_remove_all:Ne \l__codedoc_tmpa_tl { \iow_char:N \^^M }
        \__codedoc_detect_internals:N \l__codedoc_tmpa_tl
        \__codedoc_replace_at_at:N \l__codedoc_tmpa_tl
        \tl_set:Ne \l__codedoc_tmpa_tl 
          { 
            \clist_map_function:NN \l__codedoc_tmpa_tl 
              \__ztex_add_parent_key:n
          }
        \exp_args:NNe \seq_set_from_clist:Nn #2
          { \l__codedoc_tmpa_tl }
      }
  }
\cs_set:Npn \__ztex_add_parent_key:n #1 
  {
    \textcolor{gray}{\l__codedoc_parent_key_ztex_tl/}
    \tl_trim_spaces:n {#1},
  }
\cs_set_eq:NN \cctabend \cctab_end:
\cctab_const:Nn \g__ztex_keyval_cctab 
{
  \cctab_select:N \c_document_cctab
  \char_set_catcode_active:n {124}
}
\DeclareDocumentEnvironment { keyval } { O{} +m }
  { 
    \cctab_begin:N \g__ztex_keyval_cctab
    \__codedoc_function_ztex:nnw {#1} {#2} 
  }
  { 
    \__codedoc_function_end: 
    % \cctab_end: 
  }
\group_begin:
\catcode`|=\active
\gdef\ztexbar{\def|{\textup{YYY}}}
\group_end:
\DeclareDocumentEnvironment { syntax } { }
  { 
    \cctab_begin:N \g__ztex_keyval_cctab
    % \catcode`|=\active
    \ztexbar
    \__codedoc_syntax:w 
  }{
    \__codedoc_syntax_end:
    \cctab_end: 
    \ignorespacesafterend
  }
\ExplSyntaxOff


\begin{document}
\tableofcontents
\section{Hello}
Hello world.
\begin{function}[added=2024-04-27]{\testA}
  \begin{syntax}
    \cs{testA}\oarg{arg1}\meta{\upshape{AAA\string|BBB}}
    \cs{testA}\oarg{arg1}\meta{AAA|BBB}
  \end{syntax}
  A simple test for verb short hand, |.
\end{function}



Key value, |, env test:
\begin{keyval}[parent=lang]{en, cn, en cn}
\begin{syntax}
en > value forbidden 
en cn > value forbidden 
cn > initial value:\textcolor{red}{9999}
\end{syntax}
document class automatically processes and loads corresponding packages based
on user-specified options. Therefore, the packages and commands loaded by the z\TeX{}
document class vary depending on
\end{keyval}


\newpage
Hello world II.
\begin{function}[added=2024-04-27]{\testB}
  \begin{syntax}
    \cs{testB}\Arg{arg1}\meta{\upshape{AAA\string|BBB}}
    \cs{testB}\parg{arg1}\meta{AAA|BBB}
  \end{syntax}
  A simple test for verb short hand.
\end{function}
\end{document}