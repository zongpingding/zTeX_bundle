\ProvidesExplFile{zlatex.module.toc.tex}{2025/01/20}{1.0.1}{toc~module~for~zlatex}


%%%%%     toc setup module for zlatex     %%%%%
% ==> main ToC interface
\AddToHook{cmd/@starttoc/before}{\vspace*{\dim_use:N \g__zlatex_toc_title_vspace_dim}}
\zlatex_hook_preamble_last:n {
  % multi-column toc
  \int_compare:nNnT {\g__zlatex_toc_column_int} > {1} 
    {
      \RequirePackage{multicol}
      \AddToHook{cmd/@starttoc/before}{
        \begin{multicols}{\int_use:N \g__zlatex_toc_column_int}  
      }
      \AddToHook{cmd/@starttoc/after}{\end{multicols}}
    }
  % toc strech
  \AddToHookNext{cmd/@starttoc/before}{
    \renewcommand{\baselinestretch}{\fp_use:N \g__zlatex_toc_stretch_fp}\normalsize 
  }
  \AddToHookNext{cmd/@starttoc/after}{
    \renewcommand{\baselinestretch}{1.3}\normalsize 
  }
}


% ==> partial ToC
\RequirePackage{titletoc}
\NewDocumentCommand\zlatexPartialTocStop{mm}{
  \int_compare:nNnTF {#2}<{1}
    {\relax}{\stopcontents[#1]}
}
\NewDocumentCommand{\zlatexPartialToc}{O{2}}{
  % toc depth
  \setcounter{tocdepth}{#1} 
  \titlecontents{psection}[2em]
    {} {\contentslabel{2em}} {} {\titlerule*[1pc]{.}\contentspage}
  \titlecontents{psubsection}[4.5em]
    {} {\contentslabel{2.5em}} {} {\titlerule*[1pc]{.}\contentspage}
  \titlecontents{psubsubsection}[5.5em]
    {} {\contentslabel{0em}} {} {\titlerule*[1pc]{.}\contentspage}
  % print partial Toc
  \IfClassLoadedTF{book}{ 
    \startcontents[chapters]
    \printcontents[chapters]{p}{1}{}
    \AddToHook{cmd/chapter/before}{\zlatexPartialTocStop{chapters}{\thechapter}}
  }{
    \startcontents[sections]
    \printcontents[sections]{p}{1}{}
    \AddToHook{cmd/section/before}{\zlatexPartialTocStop{sections}{\thesection}}
  }
}