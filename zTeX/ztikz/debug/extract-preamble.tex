\InputIfFileExists {ztikz-cfg.tex}{}{}
\documentclass {article}
\usepackage {xcolor}
\usepackage {tikz}
\usepackage {xsimverb}
\usepackage {ztool}
\usepackage {xparse}
\makeatletter 
\ExplSyntaxOn 
\tl_new:N \l_ztikz_cache_forward_value_tl 
\str_new:N \l_ztikz_cache_forward_name_str 
\keys_define:nn {ztikz/cache}
{delimiter.tl_set:N=\l_ztikz_cache_arg_delimiter_tl ,delimiter.initial:n={[]},forward.clist_set:N=\l_ztikz_cache_forward_clist ,forward.initial:n={\empty },}
\cs_new:Npn \__ztikz_cache_deps:n ##1
{\c_percent_str \exp_not:n {##1}:= ##1
}
\NewDocumentCommand {\ztikzCacheEnv }{om}
{\DeclareEnvironmentCopy {ztikz@cached@##2}{##2}\IfValueT {##1}{\keys_set:nn {ztikz/cache}{##1}}\exp_args:Nne \DeclareDocumentEnvironment {##2}{D\l_ztikz_cache_arg_delimiter_tl {}}{\tl_if_empty:VTF \l_ztikz_cache_arg_delimiter_tl {\xsim_file_write_start:nn {\c_true_bool }{ZZZ.tex}\typeout {-->empty arg}}{\xsim_file_write_start:nn {\c_false_bool }{ZZZ.tex}}}{\xsim_file_write_stop: \ztool_insert_to_file:nnn {ZZZ.tex}{1}{\clist_map_function:NN \l_ztikz_cache_forward_clist \__ztikz_cache_deps:n \exp_not:N \begin {ztikz@cached@##2}\tl_item:Nn \l_ztikz_cache_arg_delimiter_tl {1}####1\tl_item:Nn \l_ztikz_cache_arg_delimiter_tl {-1}}\ztool_append_to_file:nn {ZZZ.tex}{\exp_not:N \end {ztikz@cached@##2}}}}
\ExplSyntaxOff 
\ztikzCacheEnv [delimiter=[],forward={\AAA ,\empty }]{tikzpicture}
