\NeedsTeXFormat{LaTeX2e}
\ProvidesExplPackage{ztikz}{2024/06/12}{1.0.0}{A~pre-release~diagram~plot~package}



% ----------------------------------------------------------------------
%                        load module interface
% ----------------------------------------------------------------------
\clist_new:N \g__ztikz_module_library_loaded_clist
\clist_gclear:N \g__ztikz_module_library_loaded_clist
\cs_new_nopar:Npn \__ztikz_load_module_library:nn #1#2 
  {
    \clist_map_inline:nn {#2} {
      \clist_if_in:NnTF \g__ztikz_module_library_loaded_clist {##1} {
        \msg_set:nnn {ztikz} {#1-loaded} {ztikz~#1~"##1"~already~loaded,ignored~loading~\msg_line_context:}
        \msg_warning:nnn {ztikz} {#1-loaded} {##1}
      }{
        \file_if_exist:nTF {#1/ztikz.#1.##1.tex}{
          \clist_gput_right:Nn \g__ztikz_module_library_loaded_clist {##1}
          \makeatletter\file_input:n {#1/ztikz.#1.##1.tex}
        }{
          \msg_set:nnn {ztikz} {#1-not-found} {ztikz~#1~`##1'~not~found.}
          \msg_error:nnn {ztikz} {#1-not-found} {##1}
        }
      }
    }
  }
\NewDocumentCommand\ztikzloadmodule{m}{
  \__ztikz_load_module_library:nn {module}{#1}\ExplSyntaxOff
}
\NewDocumentCommand\ztikzloadlibrary{m}{
  \__ztikz_load_module_library:nn {library}{#1}\ExplSyntaxOff
}
\cs_new_protected:Npn \ztikz_option_keys_define:n
  { \keys_define:nn { ztikz / option } }
\cs_new_protected:Npn \ztikz_keys_define:nn #1
  { \keys_define:nn { ztikz / #1} }
\cs_new_protected:Npn \ztikz_keys_set:nn #1
  { \keys_set:nn { ztikz / #1 } }



% ----------------------------------------------------------------------
%                        Init ztikz's Environment
% ----------------------------------------------------------------------
\RequirePackage{ztool}
\ztool_shell_mkdir:n {ztikz_output/}
\tl_const:Nn \g__ztikz_scripts_path_tl  {ztikz_output/scripts}
\NewDocumentCommand\ztikzMkdir{m}{ \ztool_shell_mkdir:n {#1} }
\__ztikz_load_module_library:nn {library}{basic}
\cs_new_protected:Npn \ztikz_term_info:n #1 
  {
    \iow_now:Nn \c_term_iow {#1}
  }
\cs_new_protected:Npn \ztikz_term_info:e #1 
  {
    \iow_now:Ne \c_term_iow {#1}
  }
% \cs_generate_variant:Nn \ztikz_term_info:n { e }



% ----------------------------------------------------------------------
%                            basic packages
% ----------------------------------------------------------------------
\RequirePackage{tikz}
\RequirePackage{etoolbox}
\patchcmd{\pgfutil@InputIfFileExists}{\input #1}{%
  \@pushfilename
  \xdef\@currname{#1}%
  \input #1 %
  \@popfilename
}{}{}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{intersections}
\usetikzlibrary{patterns}
\usetikzlibrary{plotmarks}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{fadings}



% ----------------------------------------------------------------------
%                          ztikz's cache mechanism 
% ----------------------------------------------------------------------
\cs_generate_variant:Nn \ior_open:Nn { Ne }
\cs_generate_variant:Nn \iow_open:Nn { Ne }
\prg_new_conditional:Npnn \ztikz_hash_if_change:nn #1 {p, T, F, TF}
  {
    \bool_gset_true:N \g__hash_change_bool
  }
\prg_generate_conditional_variant:Nnn 
  \ztikz_hash_if_change:nn { ne } { p, T, F, TF }